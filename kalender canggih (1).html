<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalender AI Premium üíé</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --tertiary-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --quaternary-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --bg-color: #f8f9ff;
            --text-color: #2d3436;
            --shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-color);
            min-height: 100vh;
            transition: all 0.3s ease;
            overflow-x: hidden;
        }

        /* Dark mode */
        body.dark-mode {
            --bg-color: #0f0f23;
            --text-color: #ffffff;
            --shadow: 0 10px 40px rgba(255, 255, 255, 0.1);
        }

        /* Background animated */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.8;
        }

        .bg-animation span {
            position: absolute;
            display: block;
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            animation: move 25s linear infinite;
            bottom: -150px;
        }

        @keyframes move {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
                border-radius: 0;
            }
            100% {
                transform: translateY(-1000px) rotate(720deg);
                opacity: 0;
                border-radius: 50%;
            }
        }

        /* Main container */
        .main-container {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
            min-height: 100vh;
        }

        /* Calendar section */
        .calendar-section {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 40px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        body.dark-mode .calendar-section {
            background: rgba(30, 30, 50, 0.9);
        }

        .header-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .theme-selector {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .theme-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .theme-btn:hover {
            transform: scale(1.2);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .theme-btn.active::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 20px;
        }

        .controls-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            background: var(--primary-gradient);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .calendar-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .month-display {
            font-size: 2.5em;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .year-display {
            font-size: 1.5em;
            color: var(--text-color);
            opacity: 0.7;
        }

        .calendar-nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .nav-arrow {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--secondary-gradient);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            transition: all 0.3s ease;
        }

        .nav-arrow:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .day-header {
            text-align: center;
            padding: 15px;
            background: var(--tertiary-gradient);
            color: white;
            border-radius: 15px;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.9em;
        }

        .day-cell {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background: rgba(255, 255, 255, 0.5);
            border: 2px solid transparent;
        }

        body.dark-mode .day-cell {
            background: rgba(255, 255, 255, 0.1);
        }

        .day-cell:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            background: var(--quaternary-gradient);
            color: white;
        }

        .day-cell.today {
            background: var(--secondary-gradient);
            color: white;
            animation: pulse 2s infinite;
        }

        .day-cell.selected {
            background: var(--primary-gradient);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .day-cell.other-month {
            opacity: 0.3;
        }

        .day-number {
            font-size: 1.5em;
            font-weight: 600;
        }

        .day-events {
            font-size: 0.8em;
            margin-top: 5px;
        }

        .event-dot {
            width: 8px;
            height: 8px;
            background: #ff6b6b;
            border-radius: 50%;
            display: inline-block;
            margin: 0 2px;
        }

        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .widget {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 25px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        body.dark-mode .widget {
            background: rgba(30, 30, 50, 0.9);
        }

        .widget-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .weather-widget {
            text-align: center;
        }

        .weather-icon {
            font-size: 3em;
            margin: 10px 0;
        }

        .weather-temp {
            font-size: 2em;
            font-weight: 700;
            margin: 10px 0;
        }

        .weather-desc {
            color: var(--text-color);
            opacity: 0.8;
        }

        .todo-widget {
            max-height: 300px;
            overflow-y: auto;
        }

        .todo-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            margin: 5px 0;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 15px;
            transition: all 0.3s ease;
        }

        body.dark-mode .todo-item {
            background: rgba(255, 255, 255, 0.1);
        }

        .todo-item:hover {
            transform: translateX(5px);
        }

        .todo-checkbox {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
        }

        .todo-text {
            flex: 1;
            color: var(--text-color);
        }

        .todo-item.completed .todo-text {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .add-todo {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .add-todo input {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.05);
            color: var(--text-color);
        }

        body.dark-mode .add-todo input {
            background: rgba(255, 255, 255, 0.1);
        }

        .add-btn {
            padding: 10px 15px;
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
        }

        /* AI Assistant */
        .ai-assistant {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: var(--primary-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .ai-assistant:hover {
            transform: scale(1.1);
        }

        .ai-chat {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 350px;
            height: 500px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            display: none;
            flex-direction: column;
            z-index: 1001;
        }

        body.dark-mode .ai-chat {
            background: rgba(30, 30, 50, 0.95);
        }

        .ai-chat-header {
            padding: 20px;
            background: var(--primary-gradient);
            color: white;
            border-radius: 25px 25px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-chat-body {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .ai-chat-input {
            padding: 20px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 10px;
        }

        .ai-chat-input input {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.05);
            color: var(--text-color);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            }
        }

        @media (max-width: 600px) {
            .main-container {
                padding: 15px;
            }
            
            .calendar-section {
                padding: 20px;
            }
            
            .month-display {
                font-size: 2em;
            }
            
            .day-cell {
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <!-- Background Animation -->
    <div class="bg-animation" id="bgAnimation"></div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Calendar Section -->
        <div class="calendar-section">
            <div class="header-controls">
                <div class="theme-selector">
                    <button class="theme-btn active" style="background: linear-gradient(135deg, #667eea, #764ba2)" onclick="changeTheme('default')"></button>
                    <button class="theme-btn" style="background: linear-gradient(135deg, #ff9a9e, #fecfef)" onclick="changeTheme('pink')"></button>
                    <button class="theme-btn" style="background: linear-gradient(135deg, #a8edea, #fed6e3)" onclick="changeTheme('mint')"></button>
                    <button class="theme-btn" style="background: linear-gradient(135deg, #ffecd2, #fcb69f)" onclick="changeTheme('sunset')"></button>
                </div>
                
                <div class="controls-right">
                    <button class="control-btn" onclick="toggleDarkMode()">
                        <i class="fas fa-moon" id="darkModeIcon"></i>
                    </button>
                    <button class="control-btn" onclick="exportCalendar()">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="control-btn" onclick="syncWithGoogle()">
                        <i class="fab fa-google"></i>
                    </button>
                </div>
            </div>

            <div class="calendar-header">
                <div class="month-display" id="monthDisplay">Agustus</div>
                <div class="year-display" id="yearDisplay">2025</div>
            </div>

            <div class="calendar-nav">
                <button class="nav-arrow" onclick="previousMonth()">‚ùÆ</button>
                <button class="nav-arrow" onclick="goToToday()" style="font-size: 1em;">üìÖ</button>
                <button class="nav-arrow" onclick="nextMonth()">‚ùØ</button>
            </div>

            <div class="calendar-grid" id="calendarGrid">
                <!-- Calendar will be generated here -->
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Weather Widget -->
            <div class="widget weather-widget">
                <div class="widget-title">üå§Ô∏è Cuaca Hari Ini</div>
                <div class="weather-icon" id="weatherIcon">‚òÄÔ∏è</div>
                <div class="weather-temp" id="weatherTemp">28¬∞C</div>
                <div class="weather-desc" id="weatherDesc">Cerah berawan</div>
            </div>

            <!-- To-Do Widget -->
            <div class="widget todo-widget">
                <div class="widget-title">‚úÖ To-Do List</div>
                <div id="todoList"></div>
                <div class="add-todo">
                    <input type="text" id="newTodo" placeholder="Tambah tugas baru..." onkeypress="handleTodoInput(event)">
                    <button class="add-btn" onclick="addTodo()">+</button>
                </div>
            </div>

            <!-- Stats Widget -->
            <div class="widget">
                <div class="widget-title">üìä Statistik</div>
                <div id="statsContent">
                    <div>üìÖ Event bulan ini: <strong id="eventCount">0</strong></div>
                    <div>‚úÖ Tugas selesai: <strong id="completedTasks">0</strong></div>
                    <div>üéØ Produktivitas: <strong id="productivity">0%</strong></div>
                </div>
            </div>

            <!-- Mood Tracker -->
            <div class="widget">
                <div class="widget-title">üòä Mood Tracker</div>
                <div style="display: flex; justify-content: space-around; font-size: 1.5em;">
                    <span class="mood-emoji" onclick="setMood('happy')">üòä</span>
                    <span class="mood-emoji" onclick="setMood('sad')">üò¢</span>
                    <span class="mood-emoji" onclick="setMood('excited')">ü§©</span>
                    <span class="mood-emoji" onclick="setMood('tired')">üò¥</span>
                    <span class="mood-emoji" onclick="setMood('angry')">üò†</span>
                </div>
                <div id="moodDisplay" style="text-align: center; margin-top: 10px;">
                    Pilih mood hari ini!
                </div>
            </div>
        </div>
    </div>

    <!-- AI Assistant -->
    <div class="ai-assistant" onclick="toggleAIChat()">
        <i class="fas fa-robot"></i>
    </div>

    <div class="ai-chat" id="aiChat">
        <div class="ai-chat-header">
            <span>ü§ñ AI Assistant</span>
            <button onclick="toggleAIChat()" style="background: none; border: none; color: white; cursor: pointer;">‚úñ</button>
        </div>
        <div class="ai-chat-body" id="aiChatBody">
            <div>Halo! Saya AI assistant kalender. Ada yang bisa saya bantu?</div>
        </div>
        <div class="ai-chat-input">
            <input type="text" id="aiInput" placeholder="Tanya saya apa saja..." onkeypress="handleAIInput(event)">
            <button class="add-btn" onclick="sendAIMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <script>
        // Global variables
        let currentDate = new Date();
        let selectedDate = null;
        let todos = JSON.parse(localStorage.getItem('todos')) || [];
        let events = JSON.parse(localStorage.getItem('events')) || {};
        let moodData = JSON.parse(localStorage.getItem('moodData')) || {};
        let currentTheme = localStorage.getItem('theme') || 'default';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
            loadBackgroundAnimation();
            loadWeather();
            renderTodos();
            updateStats();
            applyTheme(currentTheme);
        });

        function initializeApp() {
            // Request notification permission
            if ('Notification' in window) {
                Notification.requestPermission();
            }
            
            // Set up service worker for PWA
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js').catch(console.error);
            }
        }

        function generateCalendar(year, month) {
            const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            const dayNames = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            
            document.getElementById('monthDisplay').textContent = monthNames[month];
            document.getElementById('yearDisplay').textContent = year;
            
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';
            
            // Add day headers
            dayNames.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'day-header';
                dayHeader.textContent = day.substring(0, 3);
                calendarGrid.appendChild(dayHeader);
            });
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            // Add previous month's days
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            for (let i = startingDayOfWeek - 1; i >= 0; i--) {
                const dayCell = createDayCell(prevMonthLastDay - i, true, year, month - 1);
                calendarGrid.appendChild(dayCell);
            }
            
            // Add current month's days
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = createDayCell(day, false, year, month);
                calendarGrid.appendChild(dayCell);
            }
            
            // Add next month's days
            const totalCells = 42;
            const remainingCells = totalCells - (startingDayOfWeek + daysInMonth);
            for (let day = 1; day <= remainingCells; day++) {
                const dayCell = createDayCell(day, true, year, month + 1);
                calendarGrid.appendChild(dayCell);
            }
        }

        function createDayCell(day, isOtherMonth, year, month) {
            const cell = document.createElement('div');
            cell.className = 'day-cell';
            if (isOtherMonth) cell.classList.add('other-month');
            
            const today = new Date();
            if (!isOtherMonth && day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                cell.classList.add('today');
            }
            
            const dayNumber = document.createElement('div');
            dayNumber.className = 'day-number';
            dayNumber.textContent = day;
            cell.appendChild(dayNumber);
            
            // Add event dots
            const dateKey = `${year}-${month + 1}-${day}`;
            if (events[dateKey] && events[dateKey].length > 0) {
                const eventContainer = document.createElement('div');
                eventContainer.className = 'day-events';
                events[dateKey].slice(0, 3).forEach(() => {
                    const dot = document.createElement('span');
                    dot.className = 'event-dot';
                    eventContainer.appendChild(dot);
                });
                cell.appendChild(eventContainer);
            }
            
            if (!isOtherMonth) {
                cell.addEventListener('click', () => selectDate(day, month, year));
                cell.addEventListener('dblclick', () => addEvent(day, month, year));
            }
            
            return cell;
        }

        function selectDate(day, month, year) {
            selectedDate = new Date(year, month, day);
            
            // Remove previous selection
            document.querySelectorAll('.day-cell.selected').forEach(cell => cell.classList.remove('selected'));
            
            // Add selection to clicked date
            const cells = document.querySelectorAll('.day-cell:not(.other-month)');
            cells.forEach(cell => {
                if (parseInt(cell.querySelector('.day-number').textContent) === day && 
                    !cell.classList.contains('other-month')) {
                    cell.classList.add('selected');
                }
            });
            
            // Show notification
            if (Notification.permission === 'granted') {
                new Notification(`üìÖ Tanggal dipilih: ${day}/${month + 1}/${year}`);
            }
            
            // Update AI context
            updateAIContext();
        }

        function changeTheme(theme) {
            currentTheme = theme;
            localStorage.setItem('theme', theme);
            applyTheme(theme);
            
            document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function applyTheme(theme) {
            const root = document.documentElement;
            
            switch(theme) {
                case 'pink':
                    root.style.setProperty('--primary-gradient', 'linear-gradient(135deg, #ff9a9e, #fecfef)');
                    root.style.setProperty('--secondary-gradient', 'linear-gradient(135deg, #ff6b9d, #ffa07a)');
                    break;
                case 'mint':
                    root.style.setProperty('--primary-gradient', 'linear-gradient(135deg, #a8edea, #fed6e3)');
                    root.style.setProperty('--secondary-gradient', 'linear-gradient(135deg, #43e97b, #38f9d7)');
                    break;
                case 'sunset':
                    root.style.setProperty('--primary-gradient', 'linear-gradient(135deg, #ffecd2, #fcb69f)');
                    root.style.setProperty('--secondary-gradient', 'linear-gradient(135deg, #ff6a88, #ff99ac)');
                    break;
                default:
                    root.style.setProperty('--primary-gradient', 'linear-gradient(135deg, #667eea, #764ba2)');
                    root.style.setProperty('--secondary-gradient', 'linear-gradient(135deg, #f093fb, #f5576c)');
            }
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const icon = document.getElementById('darkModeIcon');
            icon.className = document.body.classList.contains('dark-mode') ? 'fas fa-sun' : 'fas fa-moon';
            
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }

        function loadWeather() {
            // Simulated weather data
            const weatherIcons = ['‚òÄÔ∏è', '‚õÖ', 'üåßÔ∏è', '‚õàÔ∏è', '‚ùÑÔ∏è'];
            const weatherDescs = ['Cerah', 'Berawan', 'Hujan ringan', 'Hujan lebat', 'Salju'];
            const randomIndex = Math.floor(Math.random() * weatherIcons.length);
            
            document.getElementById('weatherIcon').textContent = weatherIcons[randomIndex];
            document.getElementById('weatherTemp').textContent = `${20 + Math.floor(Math.random() * 15)}¬∞C`;
            document.getElementById('weatherDesc').textContent = weatherDescs[randomIndex];
        }

        function renderTodos() {
            const todoList = document.getElementById('todoList');
            todoList.innerHTML = '';
            
            todos.forEach((todo, index) => {
                const todoItem = document.createElement('div');
                todoItem.className = `todo-item ${todo.completed ? 'completed' : ''}`;
                
                todoItem.innerHTML = `
                    <input type="checkbox" class="todo-checkbox" ${todo.completed ? 'checked' : ''} 
                           onchange="toggleTodo(${index})">
                    <span class="todo-text">${todo.text}</span>
                    <button onclick="deleteTodo(${index})" style="background: none; border: none; cursor: pointer;">üóëÔ∏è</button>
                `;
                
                todoList.appendChild(todoItem);
            });
            
            updateStats();
        }

        function addTodo() {
            const input = document.getElementById('newTodo');
            if (input.value.trim()) {
                todos.push({ text: input.value, completed: false, date: new Date().toISOString() });
                localStorage.setItem('todos', JSON.stringify(todos));
                input.value = '';
                renderTodos();
                
                // Add notification
                if (Notification.permission === 'granted') {
                    new Notification(`‚úÖ Tugas ditambahkan: ${todos[todos.length - 1].text}`);
                }
            }
        }

        function toggleTodo(index) {
            todos[index].completed = !todos[index].completed;
            localStorage.setItem('todos', JSON.stringify(todos));
            renderTodos();
        }

        function deleteTodo(index) {
            todos.splice(index, 1);
            localStorage.setItem('todos', JSON.stringify(todos));
            renderTodos();
        }

        function handleTodoInput(event) {
            if (event.key === 'Enter') addTodo();
        }

        function updateStats() {
            const completedTasks = todos.filter(t => t.completed).length;
            const totalTasks = todos.length;
            const productivity = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            document.getElementById('completedTasks').textContent = completedTasks;
            document.getElementById('eventCount').textContent = Object.keys(events).length;
            document.getElementById('productivity').textContent = `${productivity}%`;
        }

        function setMood(mood) {
            const today = new Date().toISOString().split('T')[0];
            moodData[today] = mood;
            localStorage.setItem('moodData', JSON.stringify(moodData));
            
            const moodDisplay = document.getElementById('moodDisplay');
            const moodEmojis = {
                happy: 'üòä Senang sekali!',
                sad: 'üò¢ Sedikit sedih',
                excited: 'ü§© Sangat bersemangat!',
                tired: 'üò¥ Butuh istirahat',
                angry: 'üò† Sedikit kesal'
            };
            
            moodDisplay.textContent = moodEmojis[mood];
        }

        function addEvent(day, month, year) {
            const eventName = prompt('Nama event:');
            if (eventName) {
                const dateKey = `${year}-${month + 1}-${day}`;
                if (!events[dateKey]) events[dateKey] = [];
                events[dateKey].push({ name: eventName, time: new Date().toISOString() });
                localStorage.setItem('events', JSON.stringify(events));
                generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
                updateStats();
            }
        }

        function exportCalendar() {
            const exportData = {
                events: events,
                todos: todos,
                moodData: moodData,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `kalender-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        }

        function syncWithGoogle() {
            alert('Fitur integrasi Google Calendar akan segera hadir! üöÄ');
        }

        function toggleAIChat() {
            const chat = document.getElementById('aiChat');
            chat.style.display = chat.style.display === 'flex' ? 'none' : 'flex';
        }

        function handleAIInput(event) {
            if (event.key === 'Enter') sendAIMessage();
        }

        function sendAIMessage() {
            const input = document.getElementById('aiInput');
            const message = input.value.trim();
            if (!message) return;
            
            const chatBody = document.getElementById('aiChatBody');
            chatBody.innerHTML += `<div style="text-align: right; margin: 10px 0;"><strong>Kamu:</strong> ${message}</div>`;
            
            // AI Response Simulation
            setTimeout(() => {
                const responses = [
                    `Saya akan bantu jadwalkan kegiatanmu!`,
                    `Bagaimana dengan menambahkan reminder untuk ini?`,
                    `Tanggal yang kamu pilih bagus untuk meeting!`,
                    `Jangan lupa istirahat ya! üòä`
                ];
                const response = responses[Math.floor(Math.random() * responses.length)];
                chatBody.innerHTML += `<div style="margin: 10px 0;"><strong>AI:</strong> ${response}</div>`;
                chatBody.scrollTop = chatBody.scrollHeight;
            }, 1000);
            
            input.value = '';
        }

        function loadBackgroundAnimation() {
            const bgAnimation = document.getElementById('bgAnimation');
            for (let i = 0; i < 50; i++) {
                const span = document.createElement('span');
                span.style.left = Math.random() * 100 + '%';
                span.style.animationDelay = Math.random() * 25 + 's';
                span.style.animationDuration = (Math.random() * 25 + 25) + 's';
                bgAnimation.appendChild(span);
            }
        }

        // Navigation functions
        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
        }

        function goToToday() {
            currentDate = new Date();
            generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
            setTimeout(() => {
                const today = new Date();
                selectDate(today.getDate(), today.getMonth(), today.getFullYear());
            }, 100);
        }

        // Load saved preferences
        const savedDarkMode = localStorage.getItem('darkMode') === 'true';
        if (savedDarkMode) {
            document.body.classList.add('dark-mode');
            document.getElementById('darkModeIcon').className = 'fas fa-sun';
        }

        // Service Worker for PWA
        if ('serviceWorker' in navigator) {
            const swContent = `
                const CACHE_NAME = 'kalender-premium-v1';
                const urlsToCache = [
                    '/',
                    '/styles.css',
                    '/script.js'
                ];

                self.addEventListener('install', event => {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then(cache => cache.addAll(urlsToCache))
                    );
                });

                self.addEventListener('fetch', event => {
                    event.respondWith(
                        caches.match(event.request)
                            .then(response => response || fetch(event.request))
                    );
                });
            `;
            
            const blob = new Blob([swContent], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            navigator.serviceWorker.register(swUrl);
        }
    </script>
</body>
</html>
